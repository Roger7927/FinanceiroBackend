<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>ADS Cyber-Finance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --neon: #00f2ff; --purple: #d2a8ff; --dark: #05070a; }
        body { background: var(--dark); color: #fff; font-family: 'Orbitron', sans-serif; padding: 40px; }
        
        /* Efeito de brilho pulsante no t√≠tulo */
        h1 { 
            color: var(--neon); text-align: center; text-transform: uppercase;
            text-shadow: 0 0 10px var(--neon), 0 0 20px var(--neon);
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; max-width: 1200px; margin: auto; }
        
        /* Cards com efeito de vidro (Glassmorphism) */
        .chart-card { 
            background: rgba(22, 27, 34, 0.8); padding: 25px; border-radius: 15px; 
            border: 1px solid var(--neon); box-shadow: 0 0 15px rgba(0, 242, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .btn-refresh {
            display: block; margin: 20px auto; padding: 12px 30px;
            background: transparent; border: 2px solid var(--neon); color: var(--neon);
            border-radius: 50px; cursor: pointer; transition: 0.4s;
        }
        .btn-refresh:hover { background: var(--neon); color: #000; box-shadow: 0 0 30px var(--neon); }
    </style>
</head>
<body>
    <h1>üõ∞Ô∏è Sistema de Monitoramento ADS</h1>
    <button class="btn-refresh" onclick="carregarDados()">SYNCHRONIZE DATABASE</button>

    <div class="dashboard-grid">
        <div class="chart-card"><canvas id="lineChart"></canvas></div>
        <div class="chart-card"><canvas id="pieChart"></canvas></div>
    </div>

    <script>
        let myLine, myPie;

        async function carregarDados() {
            try {
                const response = await fetch('http://localhost:5079/api/Financeiro/analytics');
                const data = await response.json();
                render(data.fluxo.map(x => x.dia), data.fluxo.map(x => x.valor),
                       data.gastos.map(x => x.categoria), data.gastos.map(x => x.valor));
            } catch (e) {
                // Fallback de Mestre
                render(['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom'], [1,2,1,4,3,9,5], 
                       ['A', 'B', 'C', 'D'], [25, 25, 25, 25]);
            }
        }

        function render(lLabels, lValues, pLabels, pValues) {
            if (myLine) myLine.destroy(); if (myPie) myPie.destroy(); // Limpeza de mem√≥ria
            
            myLine = new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: { labels: lLabels, datasets: [{ label: 'Cash Flow', data: lValues, borderColor: '#00f2ff', fill: true, backgroundColor: 'rgba(0,242,255,0.1)', tension: 0.4 }] }
            });

            myPie = new Chart(document.getElementById('pieChart'), {
                type: 'pie',
                data: { labels: pLabels, datasets: [{ data: pValues, backgroundColor: ['#ff7b72', '#79c0ff', '#d2a8ff', '#f0883e'] }] }
            });
        }
        carregarDados();
    </script>
</body>
</html>