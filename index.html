<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro Ultra Pro | ADS Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --neon-blue: #00f2ff; --bg-dark: #0d1117; --card-bg: #161b22; }
        body { background-color: var(--bg-dark); color: #c9d1d9; font-family: 'Segoe UI', sans-serif; padding: 40px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto 30px; }
        h1 { color: var(--neon-blue); text-shadow: 0 0 15px var(--neon-blue); margin: 0; }

        .btn-refresh { 
            background: transparent; border: 2px solid var(--neon-blue); color: var(--neon-blue);
            padding: 10px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;
            transition: 0.3s; box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
        }
        .btn-refresh:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 25px var(--neon-blue); }

        /* Grade para os gr치ficos ficarem lado a lado */
        .dashboard-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px; 
            max-width: 1200px; margin: 0 auto; 
        }
        .chart-card { 
            background: var(--card-bg); padding: 25px; border-radius: 20px; 
            border: 1px solid #30363d; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        canvas { max-height: 400px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>游 Financeiro ADS Pro</h1>
        <button class="btn-refresh" onclick="carregarDados()">游댃 ATUALIZAR DADOS</button>
    </div>

    <div class="dashboard-grid">
        <div class="chart-card">
            <h3 style="text-align: center; color: #58a6ff;">游늳 Fluxo de Caixa (C# Live)</h3>
            <canvas id="lineChart"></canvas>
        </div>

        <div class="chart-card">
            <h3 style="text-align: center; color: #d2a8ff;">游꼣 Distribui칞칚o de Gastos</h3>
            <canvas id="pieChart"></canvas>
        </div>
    </div>

    <script>
        let myLineChart, myPieChart;

        async function carregarDados() {
            let labels, valores;
            try {
                // Conectando com o seu motor C# local
                const response = await fetch('http://localhost:5079/api/Financeiro/analytics');
                const dados = await response.json();
                labels = dados.map(item => item.dia);
                valores = dados.map(item => item.valor);
            } catch (error) {
                // Fallback (Reserva) caso o motor esteja desligado
                labels = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab', 'Dom'];
                valores = [1200, 1800, 1400, 3200, 2900, 4500, 4100];
            }
            atualizarGraficos(labels, valores);
        }

        function atualizarGraficos(labels, valores) {
            const ctxLine = document.getElementById('lineChart').getContext('2d');
            const ctxPie = document.getElementById('pieChart').getContext('2d');

            // Se os gr치ficos j치 existem, destr칩i para criar novos (evita sobreposi칞칚o)
            if (myLineChart) myLineChart.destroy();
            if (myPieChart) myPieChart.destroy();

            // Gr치fico de Linha Neon
            myLineChart = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Saldo (R$)',
                        data: valores,
                        borderColor: '#00f2ff',
                        backgroundColor: 'rgba(0, 242, 255, 0.1)',
                        fill: true, tension: 0.4, borderWidth: 4
                    }]
                },
                options: { plugins: { legend: { display: false } } }
            });

            // NOVO: Gr치fico de Pizza Profissional
            myPieChart = new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: ['Aluguel', 'Nuvem (Azure)', 'Sal치rios', 'Marketing'],
                    datasets: [{
                        data: [3000, 1500, 5000, 2000],
                        backgroundColor: ['#ff7b72', '#79c0ff', '#d2a8ff', '#f0883e'],
                        borderWidth: 0
                    }]
                }
            });
        }

        carregarDados();
    </script>
</body>
</html>